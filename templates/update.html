{% extends "layout.html" %}

{% block content %}
<h2 id="formTitle">Create Stat Block</h2>

<div class="row g-3 mb-3">
  <div class="col-md-9">
    <label class="form-label">Name</label>
    <div class="input-group">
      <input id="name" class="form-control">
      <button class="btn btn-outline-secondary" type="button" id="truecase-name-btn" title="Convert to Title Case">Aa</button>
    </div>
  </div>
  <div class="col-md-3">
    <label class="form-label">Category</label>
    <select id="category" class="form-select">
      {% for cat in categories.keys() %}
      <option value="{{cat}}">{{cat}}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Tier</label>
    <select id="tier" class="form-select">
      {% for t in tiers %}
      <option value="{{t}}">{{t}}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-9">
    <label class="form-label">Type</label>
    <select id="type" class="form-select"></select>
  </div>
  <div class="col-12">
    <label class="form-label">Description (Markdown supported)</label>
    <div class="input-group">
      <textarea id="description" class="form-control" rows="3"></textarea>
      <button class="btn btn-outline-secondary format-newline-btn" type="button" title="Remove newlines">↵</button>
    </div>
  </div>
</div>

<!-- Adversary Fields -->
<div id="adversaryFields" class="row g-3 mb-3" style="display: none;">
  <div class="col-12">
    <label class="form-label">Motives & Tactics</label>
    <div class="input-group">
      <textarea id="motives_tactics" class="form-control" rows="2"></textarea>
      <button class="btn btn-outline-secondary format-newline-btn" type="button" title="Remove newlines">↵</button>
    </div>
  </div>
  <div class="col-md-3">
    <label class="form-label">Difficulty</label>
    <input id="difficulty" class="form-control">
  </div>
  <div class="col-md-3">
    <label class="form-label">Thresholds</label>
    <input id="thresholds" class="form-control">
  </div>
  <div class="col-md-2">
    <label class="form-label">HP</label>
    <input id="hp" class="form-control">
  </div>
  <div class="col-md-2">
    <label class="form-label">Stress</label>
    <input id="stress" class="form-control">
  </div>
  <div class="col-md-2">
    <label class="form-label">ATK</label>
    <input id="atk" class="form-control" placeholder="+X">
  </div>
  <div class="col-12">
    <h5>Weapon</h5>
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Name</label>
        <input id="weapon" class="form-control">
      </div>
      <div class="col-md-2">
        <label class="form-label">Range</label>
        <select id="weapon_range" class="form-select">
          <option>Melee</option>
          <option>Very Close</option>
          <option>Close</option>
          <option>Far</option>
          <option>Very Far</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Damage Dice</label>
        <input id="weapon_damage_dice" class="form-control" placeholder="e.g., 1d6">
      </div>
      <div class="col-md-3">
        <label class="form-label">Damage Type</label>
        <select id="weapon_damage_type" class="form-select">
          <option>phy</option>
          <option>mag</option>
        </select>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <label class="form-label">Experience</label>
    <input id="experience" class="form-control">
  </div>
</div>

<!-- Environment Fields -->
<div id="environmentFields" class="row g-3 mb-3" style="display: none;">
  <div class="col-12">
    <label class="form-label">Impulses</label>
    <div class="input-group">
      <textarea id="impulses" class="form-control" rows="2"></textarea>
      <button class="btn btn-outline-secondary format-newline-btn" type="button" title="Remove newlines">↵</button>
    </div>
  </div>
  <div class="col-md-6">
    <label class="form-label">Difficulty</label>
    <input id="env_difficulty" class="form-control">
  </div>
  <div class="col-md-6">
    <label class="form-label">Potential Adversaries</label>
    <input id="potential_adversaries" class="form-control">
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-2">
  <h3>Features</h3>
  <button id="addFeature" class="btn btn-sm btn-outline-secondary">Add Feature</button>
</div>
<div id="features"></div>

<template id="featureTpl">
  <div class="card mb-2 feature-item">
    <div class="card-body">
      <div class="row g-2">
        <div class="col-md-4">
          <input class="form-control feature-name" placeholder="Feature name">
        </div>
        <div class="col-md-3">
          <select class="form-select feature-type">
            <option>Passive</option>
            <option>Action</option>
            <option>Reaction</option>
            <option>Evolution</option>
            <option>Transformation</option>
          </select>
        </div>
        <div class="col-md-5 text-end">
          <button class="btn btn-sm btn-danger remove-feature">Remove</button>
        </div>
      </div>
      <div class="mt-2">
        <div class="input-group">
          <textarea class="form-control feature-desc" rows="3" placeholder="Feature description"></textarea>
          <button class="btn btn-outline-secondary format-newline-btn" type="button" title="Remove newlines">↵</button>
        </div>
      </div>
    </div>
  </div>
</template>

<div class="mt-4">
  <button id="saveBtn" type="button" class="btn btn-primary">Save</button>
  <a class="btn btn-outline-secondary" href="/">Cancel</a>
  <button id="loadBtn" class="btn btn-info">Load from Text</button>
</div>
<div class="modal fade" id="loadModal2" tabindex="-1" aria-labelledby="loadModalLabel2" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="loadModalLabel2">JSON version of loaded data</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="outputJsonStat" class="form-control" rows="15" placeholder="Paste statblock text here..."></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Load from Text Modal -->
<div class="modal fade" id="loadModal" tabindex="-1" aria-labelledby="loadModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="loadModalLabel">Load Statblock from Text</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="loadStatblockText" class="form-control" rows="15" placeholder="Paste statblock text here..."></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" id="loadStatblockSave" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}
